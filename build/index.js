!function(e){var t={};function a(s){if(t[s])return t[s].exports;var r=t[s]={i:s,l:!1,exports:{}};return e[s].call(r.exports,r,r.exports,a),r.l=!0,r.exports}a.m=e,a.c=t,a.d=function(e,t,s){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(a.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)a.d(s,r,function(t){return e[t]}.bind(null,r));return s},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=4)}([function(e,t){e.exports=require("mongoose")},function(e,t){e.exports=require("lodash")},function(e,t){e.exports=require("node-telegram-bot-api")},function(e,t){e.exports=require("dotenv")},function(e,t,a){e.exports=a(5)},function(e,t,a){"use strict";a.r(t);var s=a(2),r=a.n(s),o=a(3),n=a.n(o),i=a(0),d=a.n(i),m=a(1),l=a.n(m);const _=new(0,d.a.Schema)({telegram_id:{type:Number,required:!0},username:{type:String,trim:!0},first_name:{type:String,trim:!0},last_name:{type:String,trim:!0},updated_at:{type:Date,default:Date.now,select:!1},created_at:{type:Date,default:Date.now,select:!1}},{collection:"users"});var u=d.a.model("User",_);const g=new(0,d.a.Schema)({title:{type:String,trim:!0,default:"default",required:!0},group_id:{type:Number,required:!0},users:[_],updated_at:{type:Date,default:Date.now,select:!1},created_at:{type:Date,default:Date.now,select:!1}},{collection:"summonGroups"});var c=d.a.model("SummonGroup",g);const p=new(0,d.a.Schema)({telegram_id:{type:Number,unique:!0,required:!0},title:{type:String,trim:!0},summon_groups:[g],updated_at:{type:Date,default:Date.now,select:!1},created_at:{type:Date,default:Date.now,select:!1}},{collection:"groupChats"});var f=d.a.model("GroupChat",p);const w=n.a.config();if(w.error)throw w.error;let y=`mongodb://${process.env.DB_HOST}:${process.env.DB_PORT}/${process.env.DB_NAME}`;d.a.connect(y,{useCreateIndex:!0,useNewUrlParser:!0});const h=process.env.BOT_TOKEN,v=new r.a(h,{polling:!0});v.onText(/^\/ping$/,async e=>{console.log(e);const t=e.chat.id;v.sendMessage(t,"***Pretty*** `pong`",{reply_to_message_id:e.message_id,parse_mode:"markdown"})}),v.onText(/^\/summon$/,async(e,t)=>{console.log(e);const a=e.chat.id;try{if(e.from.is_bot)return!1;if("private"===e.chat.type)return!1;let t=await f.findOne({telegram_id:e.chat.id}).exec();if(null===t){let s=new c({group_id:a});return await s.save(),t=new f({telegram_id:e.chat.id,title:e.chat.title,summon_groups:[s]}),await t.save(),v.sendMessage(a,"Group ***default*** Created Successfully",{reply_to_message_id:e.message_id,parse_mode:"markdown"}),!1}let s=await c.findOne({group_id:a,title:"default"}).exec();if(null===s)return s=new c({title:"default",group_id:a}),await s.save(),t.summon_groups.push(s),await t.save(),v.sendMessage(a,"Group ***default*** Created Successfully",{reply_to_message_id:e.message_id,parse_mode:"markdown"}),!1;if(0===s.users.length)return v.sendMessage(a,"Group ***default*** is empty :(",{reply_to_message_id:e.message_id,parse_mode:"markdown"}),!1;let r=s.users;(r=l.a.chunk(r,5)).forEach(e=>{let t="";e.forEach(e=>{t+=` @${e.username}`}),v.sendMessage(a,t.trim())})}catch(t){console.log(t),v.sendMessage(a,"Failed and I don't know why",{reply_to_message_id:e.message_id,parse_mode:"markdown"})}}),v.onText(/^\/summon\s(\S+)$/,async(e,t)=>{console.log(e,t);const a=e.chat.id,s=t[1];try{if(e.from.is_bot)return!1;if("private"===e.chat.type)return!1;let t=await f.findOne({telegram_id:e.chat.id}).exec();if(null===t){let r=new c({title:s,group_id:a});return await r.save(),t=new f({telegram_id:e.chat.id,title:e.chat.title,summon_groups:[r]}),await t.save(),v.sendMessage(a,`Group ***${s}*** Created Successfully`,{reply_to_message_id:e.message_id,parse_mode:"markdown"}),!1}let r=await c.findOne({group_id:a,title:s}).exec();if(console.log(r),null===r)return r=new c({title:s,group_id:a}),console.log(r),await r.save(),t.summon_groups.push(r),await t.save(),v.sendMessage(a,`Group ***${s}*** Created Successfully`,{reply_to_message_id:e.message_id,parse_mode:"markdown"}),!1;if(0===r.users.length)return v.sendMessage(a,`Group ***${s}*** is empty :(`,{reply_to_message_id:e.message_id,parse_mode:"markdown"}),!1;let o=r.users;console.log(o),o=l.a.chunk(o,5),console.log(o),o.forEach(e=>{let t="";e.forEach(e=>{t+=` @${e.username}`}),console.log(t),v.sendMessage(a,t.trim())})}catch(t){console.log(t),v.sendMessage(a,"Failed and I don't know why",{reply_to_message_id:e.message_id,parse_mode:"markdown"})}}),v.onText(/^\/summon_add$/,async(e,t)=>{console.log(e);const a=e.chat.id;try{if(e.from.is_bot)return!1;if("private"===e.chat.type)return!1;if(null===await f.findOne({telegram_id:e.chat.id}).exec())return v.sendMessage(a,"No group was created in this chat :(",{reply_to_message_id:e.message_id,parse_mode:"markdown"}),!1;let t=await c.findOne({group_id:a,title:"default"}).exec();if(null===t)return v.sendMessage(a,"Group ***default*** doesn't exist :(",{reply_to_message_id:e.message_id,parse_mode:"markdown"}),!1;let s=await u.findOne({telegram_id:e.from.id}).exec();if(null===s&&(s=new u({telegram_id:e.from.id,username:e.from.username,first_name:e.from.first_name,last_name:e.from.last_name}),await s.save()),t.users.filter(e=>e.telegram_id===s.telegram_id).length>0)return v.sendMessage(a,"You are already in the group ***default***",{reply_to_message_id:e.message_id,parse_mode:"markdown"}),!1;t.users.push(s),await t.save(),v.sendMessage(a,"You were ***added*** in the group ***default***",{reply_to_message_id:e.message_id,parse_mode:"markdown"})}catch(t){console.log(t),v.sendMessage(a,"Failed and I don't know why",{reply_to_message_id:e.message_id,parse_mode:"markdown"})}}),v.onText(/^\/summon_add\s(\S+)$/,async(e,t)=>{console.log(e,t);const a=e.chat.id,s=t[1];try{if(e.from.is_bot)return!1;if("private"===e.chat.type)return!1;if(null===await f.findOne({telegram_id:e.chat.id}).exec())return v.sendMessage(a,"No group was created in this chat :(",{reply_to_message_id:e.message_id,parse_mode:"markdown"}),!1;let t=await c.findOne({group_id:a,title:s}).exec();if(null===t)return v.sendMessage(a,`Group ***${s}*** doesn't exist :(`,{reply_to_message_id:e.message_id,parse_mode:"markdown"}),!1;let r=await u.findOne({telegram_id:e.from.id}).exec();if(r||(r=new u({telegram_id:e.from.id,username:e.from.username,first_name:e.from.first_name,last_name:e.from.last_name}),await r.save()),t.users.filter(e=>e.telegram_id===r.telegram_id).length>0)return v.sendMessage(a,`You are already in the group ***${s}***`,{reply_to_message_id:e.message_id,parse_mode:"markdown"}),!1;t.users.push(r),await t.save(),v.sendMessage(a,`You have been ***added*** in the group ***${s}***`,{reply_to_message_id:e.message_id,parse_mode:"markdown"})}catch(t){console.log(t),v.sendMessage(a,"Failed and I don't know why",{reply_to_message_id:e.message_id,parse_mode:"markdown"})}}),v.onText(/^\/summon_rem$/,async(e,t)=>{console.log(e);const a=e.chat.id;try{if(e.from.is_bot)return!1;if("private"===e.chat.type)return!1;if(null===await f.findOne({telegram_id:e.chat.id}).exec())return v.sendMessage(a,"No group was created in this chat :(",{reply_to_message_id:e.message_id,parse_mode:"markdown"}),!1;let t=await c.findOne({group_id:a,title:"default"}).exec();if(null===t)return v.sendMessage(a,"Group ***default*** doesn't exist :(",{reply_to_message_id:e.message_id,parse_mode:"markdown"}),!1;let s=await u.findOne({telegram_id:e.from.id}).exec();if(s||(s=new u({telegram_id:e.from.id,username:e.from.username,first_name:e.from.first_name,last_name:e.from.last_name}),await s.save()),0===t.users.filter(e=>e.telegram_id===s.telegram_id).length)return v.sendMessage(a,"You are not in the group ***default***",{reply_to_message_id:e.message_id,parse_mode:"markdown"}),!1;let r=t.users.filter(e=>e.telegram_id!==s.telegram_id);t.users=r,await t.save(),v.sendMessage(a,"You have been ***removed*** from the group ***default***",{reply_to_message_id:e.message_id,parse_mode:"markdown"})}catch(e){console.log(e),v.sendMessage(a,"Failed to test")}}),v.onText(/^\/summon_rem\s(\S+)$/,async(e,t)=>{console.log(e,t);const a=e.chat.id,s=t[1];try{if(e.from.is_bot)return!1;if("private"===e.chat.type)return!1;if(null===await f.findOne({telegram_id:e.chat.id}).exec())return v.sendMessage(a,"No group was created in this chat :(",{reply_to_message_id:e.message_id,parse_mode:"markdown"}),!1;let t=await c.findOne({group_id:a,title:s}).exec();if(null===t)return v.sendMessage(a,`Group ***${s}*** doesn't exist :(`,{reply_to_message_id:e.message_id,parse_mode:"markdown"}),!1;let r=await u.findOne({telegram_id:e.from.id}).exec();if(null===r&&(r=new u({telegram_id:e.from.id,username:e.from.username,first_name:e.from.first_name,last_name:e.from.last_name}),await r.save()),0===t.users.filter(e=>e.telegram_id===r.telegram_id).length)return v.sendMessage(a,`You are not in the group ***${s}***`,{reply_to_message_id:e.message_id,parse_mode:"markdown"}),!1;let o=t.users.filter(e=>e.telegram_id!==r.telegram_id);t.users=o,await t.save(),v.sendMessage(a,`You have been ***removed*** from the group ***${s}***`,{reply_to_message_id:e.message_id,parse_mode:"markdown"})}catch(t){console.log(t),v.sendMessage(a,"Failed and I don't know why",{reply_to_message_id:e.message_id,parse_mode:"markdown"})}}),v.onText(/^\/summon_gl$/,async(e,t)=>{if(e.from.is_bot)return!1;if("private"===e.chat.type)return!1;console.log(e,t);const a=e.chat.id;let s=await v.getChatMember(e.chat.id,e.from.id);console.log(s),v.sendMessage(a,"Here I'll show the group list of this chat",{reply_to_message_id:e.message_id,parse_mode:"markdown"})}),v.onText(/^\/summon_del_g\s(\S+)$/,async(e,t)=>{if(e.from.is_bot)return!1;if("private"===e.chat.type)return!1;console.log(e,t);t[1];const a=e.chat.id;let s=await v.getChatMember(e.chat.id,e.from.id);if("creator"!==s.status&&"administrator"!==s.status)return v.sendMessage(a,"You are not an ***admin*** from this chat",{reply_to_message_id:e.message_id,parse_mode:"markdown"}),!1;console.log(s),v.sendMessage(a,"This command will delete a group",{reply_to_message_id:e.message_id,parse_mode:"markdown"})})}]);